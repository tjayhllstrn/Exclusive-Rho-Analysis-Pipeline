#!/usr/bin/python3
#the point of this script is to just take a bunch of ROOT plots generated by my code and arrange them into a collage of plots for easy readability

from PIL import Image
import os
import math




def create_image_grid(input_folder, output_file, grid_size=None):
    # Collect all png files in folder
    files = sorted([file for file in os.listdir(input_folder) if (file.endswith('.png') and file.find("cth")!=-1)])

    grid_size = (436,314)#(398,286) #image size in the grid
    main_size = (696,472) #image size in main panel
    
    grid_imgs = []
    main_imgs = []
    for file in files:
        img = Image.open(os.path.join(input_folder, file))
        if ("2D" in file or "MLMchi2" in file):
            img = img.resize((main_size[0], main_size[1]))
            main_imgs.append(img)
        elif "PhiBinningSinFit" in file:
            img = img.resize((grid_size[0],grid_size[1]))
            grid_imgs.append(img)
        
    
    main_height_total = main_size[1]*len(main_imgs)
    grid_n = int(math.sqrt(len(grid_imgs)))
    grid_width = grid_n * grid_size[0]
    grid_height = grid_n * grid_size[1]
    canvas_width = main_size[0] + grid_width
    canvas_height = max(main_height_total, grid_height)

    # Create new image that fits all
    canvas = Image.new('RGB', (canvas_width,canvas_height))

    y_offset = 0
    for img in main_imgs:
        canvas.paste(img, (0, y_offset))
        y_offset += img.height

    # Paste small images in 3x3 grid on right
    for idx, img in enumerate(grid_imgs):
        row = idx // grid_n
        col = idx % grid_n
        x = main_size[0] + col * grid_size[0]
        y = row * grid_size[1]
        canvas.paste(img, (x, y))

    canvas.save(output_file)
    print(f"Saved image grid to {output_file}")

# Usage
if __name__ == "__main__":
    create_image_grid('.', 'output_grid.png')